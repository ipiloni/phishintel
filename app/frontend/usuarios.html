<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Tablas - PhishIntel</title>

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Raleway&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
</head>

<body class="index-page">

  <!-- ======= Header ======= -->
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container position-relative d-flex align-items-center justify-content-between">
      <a href="/index" class="logo d-flex align-items-center me-auto me-xl-0">
        <h1 class="sitename">PhishIntel</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="/index">Home</a></li>
          <li><a href="/registro">Registro</a></li>
          <li><a href="/login">Login</a></li>
          <li><a href="tables.html" class="active">Tablas</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
    </div>
  </header>
  <!-- End Header -->

  <main class="main">

    <!-- Page Title -->
    <div class="page-title">
      <h1>Listado de Datos</h1>
      <div class="breadcrumbs">
        <ol>
          <li><a href="index.html">Home</a></li>
          <li>Tablas</li>
        </ol>
      </div>
    </div>

    <div id="app" class="container mt-4">
      <div class="mb-3">
        <label for="area">Filtrar por área:</label>
        <select v-model="filtroArea" id="area" class="form-select d-inline w-auto">
          <option value="">Todas</option>
          <option v-for="area in areas" :key="area.idArea" :value="area.nombreArea">
            {{ area.nombreArea }}
          </option>
        </select>
      </div>

      <div class="table-responsive">
        <table class="table table-striped table-bordered table-sm align-middle">
          <thead class="table-dark">
            <tr>
              <th>#</th>
              <th>idUsuario</th>
              <th>nombreUsuario</th>
              <th>nombre</th>
              <th>apellido</th>
              <th>direccion</th>
              <th>telefono</th>
              <th>correo</th>
              <th>esAdministrador</th>
              <th>idArea</th>
              <th>Area</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(usuario, index) in usuariosFiltrados" :key="usuario.idUsuario">
              <td>{{ index + 1 }}</td>
              <td>{{ usuario.idUsuario || "" }}</td>
              <td>{{ usuario.nombreUsuario || "" }}</td>
              <td>{{ usuario.nombre || "" }}</td>
              <td>{{ usuario.apellido || "" }}</td>
              <td>{{ usuario.direccion || "" }}</td>
              <td>{{ usuario.telefono || "" }}</td>
              <td>{{ usuario.correo || "" }}</td>
              <td>{{ usuario.esAdministrador ? "Sí" : "No" }}</td>
              <td>{{ usuario.idArea || "" }}</td>
              <td>{{ usuario.areaNombre }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>


  </main>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
  const { createApp } = Vue;

  createApp({
    data() {
      return {
        areas: [],
        filtroArea: ""
      };
    },
    computed: {
      usuariosFiltrados() {
        let usuarios = [];
        this.areas.forEach(area => {
          (area.usuarios || []).forEach(u => {
            usuarios.push({ ...u, areaNombre: area.nombreArea });
          });
        });

        if (this.filtroArea) {
          usuarios = usuarios.filter(u => u.areaNombre === this.filtroArea);
        }

        return usuarios;
      }
    },
    async mounted() {
      const resp = await fetch("http://127.0.0.1:8080/api/areas");
      const data = await resp.json();
      this.areas = data.areas || [];
    }
  }).mount("#app");
  </script>

  <script>
    AOS.init();
  </script>

</body>
</html>
