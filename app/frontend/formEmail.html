<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Generar Email - PhishIntel</title>

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Raleway&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
</head>

<body class="index-page">

  <!-- ======= Header ======= -->
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container position-relative d-flex align-items-center justify-content-between">
      <a href="/index" class="logo d-flex align-items-center me-auto me-xl-0">
        <h1 class="sitename">PhishIntel</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="/principal" class="btn-getstarted btn-login">Home</a></li>
          <li><a href="/selectorCampania" class="btn-getstarted btn-login">Volver al Panel</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
    </div>
  </header>
  <!-- End Header -->

  <main class="main">

    <!-- Page Title -->
    <div class="page-title py-5"></div>

    <!-- Formulario con Vue -->
    <section id="email" class="contact section">
      <div class="col-lg-8 mx-auto" data-aos="fade-left" data-aos-delay="200">
        <div id="app" class="contact-form-wrapper">
          <div class="form-header">
            <h3>Generaci칩n de Simulaci칩n</h3>
            <p>Selecciona el 치rea, usuario y nivel de dificultad.</p>
          </div>

          <form action="forms/generate-email.php" method="post" class="php-email-form">

            <!-- Selector de 츼rea -->
            <div class="mb-3">
              <label for="areaSelect" class="form-label">Seleccionar 츼rea</label>
              <select v-model="filtroArea" class="form-control" id="areaSelect" name="area" required>
                <option value="">-- Selecciona un 치rea --</option>
                <option v-for="area in areas" :key="area.idArea" :value="area.nombreArea">
                  {{ area.nombreArea }}
                </option>
              </select>
            </div>

            <!-- Selector de Usuario -->
            <div class="mb-3">
              <label for="userSelect" class="form-label">Seleccionar Usuario</label>
              <select class="form-control" id="userSelect" name="usuario" required>
                <option value="">-- Selecciona un usuario --</option>
                <option v-for="usuario in usuariosFiltrados" :key="usuario.idUsuario" :value="usuario.idUsuario">
                  {{ usuario.nombre }} {{ usuario.apellido }}
                </option>
              </select>
            </div>

            <!-- Dificultad -->
            <div class="mb-3">
              <label class="form-label">Nivel de Dificultad</label>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="dificultad" id="facil" value="F치cil" checked>
                <label class="form-check-label" for="facil">F치cil (Desde phishintel@gmail.com)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="dificultad" id="medio" value="Medio">
                <label class="form-check-label" for="medio">Medio (Desde pgcontrolcito.com)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="dificultad" id="dificil" value="Dif칤cil">
                <label class="form-check-label" for="dificil">Dif칤cil (Desde pgcontrol.com.ar)</label>
              </div>
            </div>

            <!-- Bot칩n de enviar -->
            <div class="text-center">
              <button type="button" class="btn btn-primary px-4 py-2 rounded-pill" data-bs-toggle="modal" data-bs-target="#previewModal">>
                <i class="bi bi-send"></i> Enviar
              </button>
            </div>

          </form>
        </div>
      </div>
    </section><!-- /Form Section -->
    <!-- Modal -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="previewModalLabel">Email Preview</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <!-- Aqu칤 mostramos la preview -->
            <p><strong>츼rea:</strong> <span id="previewArea"></span></p>
            <p><strong>Usuario:</strong> <span id="previewUsuario"></span></p>
            <p><strong>Dificultad:</strong> <span id="previewDificultad"></span></p>
            <hr>
            <p><em>Este es el contenido del email que ser치 enviado...</em></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" id="confirmSend" class="btn btn-primary">Confirmar y Enviar</button>
          </div>
        </div>
      </div>
    </div>



  </main>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script>
    AOS.init();
  </script>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          areas: [],
          filtroArea: ""
        };
      },
      computed: {
        usuariosFiltrados() {
          const areaSeleccionada = this.areas.find(a => a.nombreArea === this.filtroArea);
          return areaSeleccionada ? areaSeleccionada.usuarios : [];
        }
      },
      async mounted() {
        try {
          const resp = await fetch("http://127.0.0.1:8080/api/areas", {
            method: "GET",
            mode: "cors", // 游댐 necesario si tu API est치 en otro puerto/host
            headers: {
              "Accept": "application/json"
            }
          });

          if (!resp.ok) throw new Error("Error en la respuesta: " + resp.status);

          const data = await resp.json();
          this.areas = data.areas || [];
        } catch (e) {
          console.error("Error cargando 치reas:", e);
        }
      }
    }).mount("#app");
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.querySelector(".php-email-form");
      const previewArea = document.getElementById("previewArea");
      const previewUsuario = document.getElementById("previewUsuario");
      const previewDificultad = document.getElementById("previewDificultad");
      const confirmBtn = document.getElementById("confirmSend");

      const previewModal = document.getElementById('previewModal');
      previewModal.addEventListener('show.bs.modal', () => {
        previewArea.textContent = document.getElementById("areaSelect").value;
        previewUsuario.textContent = document.getElementById("userSelect").options[document.getElementById("userSelect").selectedIndex].text;
        previewDificultad.textContent = document.querySelector("input[name='dificultad']:checked").value;
      });

      confirmBtn.addEventListener("click", () => {
        form.submit();
      });
    });
  </script>
</body>
</html>

